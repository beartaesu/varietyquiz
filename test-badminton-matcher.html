<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë°°ë“œë¯¼í„´ ë§¤ì¹­ ì‹œë®¬ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: 'Courier New', monospace;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      color: #4ec9b0;
    }
    .controls {
      background: #252526;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .controls label {
      display: inline-block;
      width: 150px;
      color: #9cdcfe;
    }
    .controls input {
      width: 100px;
      padding: 5px;
      background: #3c3c3c;
      border: 1px solid #555;
      color: #d4d4d4;
      border-radius: 4px;
    }
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 10px;
    }
    button:hover {
      background: #1177bb;
    }
    #output {
      background: #252526;
      padding: 20px;
      border-radius: 8px;
      white-space: pre-wrap;
      font-size: 14px;
      line-height: 1.6;
      max-height: 600px;
      overflow-y: auto;
    }
    .round {
      color: #4ec9b0;
      font-weight: bold;
    }
    .stats {
      color: #ce9178;
    }
    .highlight {
      color: #dcdcaa;
    }
  </style>
</head>
<body>
  <h1>ğŸ¸ ë°°ë“œë¯¼í„´ ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ ì‹œë®¬ë ˆì´ì…˜</h1>
  
  <div class="controls">
    <div style="margin-bottom: 10px;">
      <label>ì°¸ê°€ì ìˆ˜:</label>
      <input type="number" id="playerCount" value="12" min="4" max="20">
    </div>
    <div style="margin-bottom: 10px;">
      <label>ì½”íŠ¸ ìˆ˜:</label>
      <input type="number" id="courtCount" value="3" min="1" max="10">
    </div>
    <div style="margin-bottom: 10px;">
      <label>ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜:</label>
      <input type="number" id="rounds" value="20" min="1" max="100">
    </div>
    <button onclick="runSimulation()">ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰</button>
  </div>
  
  <div id="output"></div>

  <script>
    // ë§¤ì¹­ ë¹ˆë„ ì¶”ì 
    let matchFrequency = {};
    let playerExclusionCount = {};

    // ë§¤ì¹­ í‚¤ ìƒì„±
    function getMatchKey(name1, name2) {
      return [name1, name2].sort().join("-");
    }

    // ë§¤ì¹­ íšŸìˆ˜ ì¦ê°€
    function incrementMatchCount(name1, name2) {
      const key = getMatchKey(name1, name2);
      matchFrequency[key] = (matchFrequency[key] || 0) + 1;
    }

    // ë§¤ì¹­ íšŸìˆ˜ ì¡°íšŒ
    function getMatchCount(name1, name2) {
      return matchFrequency[getMatchKey(name1, name2)] || 0;
    }

    // íŒ€ ìƒì„± (ì¤‘ë³µ ë§¤ì¹­ ë°©ì§€ ë¡œì§ í¬í•¨)
    function createTeamsFromPlayers(players) {
      const teams = [];
      const used = new Set();
      
      // 3ë²ˆ ëœë¤ ì…”í”Œ
      let shuffled = [...players];
      for (let i = 0; i < 3; i++) {
        shuffled = shuffled.sort(() => Math.random() - 0.5);
      }
      
      // ì¤‘ë³µ ë§¤ì¹­ ë°©ì§€: ì´ì „ì— í•¨ê»˜ ê²Œì„í•œ ì ì´ ì ì€ í”Œë ˆì´ì–´ë¼ë¦¬ ìš°ì„  ë§¤ì¹­
      for (let i = 0; i < shuffled.length; i++) {
        if (used.has(i)) continue;
        
        const player1 = shuffled[i];
        let bestPartnerIndex = -1;
        let lowestMatchCount = Infinity;
        
        // player1ê³¼ ê°€ì¥ ì ê²Œ ë§¤ì¹­ëœ í”Œë ˆì´ì–´ ì°¾ê¸°
        for (let j = i + 1; j < shuffled.length; j++) {
          if (used.has(j)) continue;
          
          const player2 = shuffled[j];
          const matchCount = getMatchCount(player1, player2);
          
          // ìƒˆë¡œìš´ ë§¤ì¹­ì— 3ë°° ê°€ì¤‘ì¹˜ ë¶€ì—¬
          const adjustedCount = matchCount === 0 ? -3 : matchCount;
          
          if (adjustedCount < lowestMatchCount) {
            lowestMatchCount = adjustedCount;
            bestPartnerIndex = j;
          }
        }
        
        if (bestPartnerIndex !== -1) {
          teams.push({
            players: [player1, shuffled[bestPartnerIndex]]
          });
          used.add(i);
          used.add(bestPartnerIndex);
        }
      }
      
      return teams;
    }

    // ê²Œì„ ìƒì„±
    function generateGames(players, courtCount) {
      // 5ë²ˆ ëœë¤ ì…”í”Œ
      let shuffled = [...players];
      for (let i = 0; i < 5; i++) {
        shuffled = shuffled.sort(() => Math.random() - 0.5);
      }
      
      // ì½”íŠ¸ ìˆ˜ì— ë§ì¶° ì°¸ê°€ì ì œí•œ
      const maxParticipants = courtCount * 4;
      const excludeCount = players.length - maxParticipants;
      
      // ì œì™¸í•  í”Œë ˆì´ì–´ ì„ íƒ (ê³µí‰í•˜ê²Œ)
      let excludedPlayers = [];
      if (excludeCount > 0) {
        const groupedByCount = {};
        shuffled.forEach(p => {
          const count = playerExclusionCount[p] || 0;
          if (!groupedByCount[count]) {
            groupedByCount[count] = [];
          }
          groupedByCount[count].push(p);
        });
        
        const sortedCounts = Object.keys(groupedByCount).map(Number).sort((a, b) => a - b);
        
        for (const count of sortedCounts) {
          if (excludedPlayers.length >= excludeCount) break;
          
          const candidates = groupedByCount[count];
          let candidatesShuffled = [...candidates];
          for (let i = 0; i < 3; i++) {
            candidatesShuffled = candidatesShuffled.sort(() => Math.random() - 0.5);
          }
          
          const needed = excludeCount - excludedPlayers.length;
          excludedPlayers.push(...candidatesShuffled.slice(0, needed));
        }
      }
      
      // ì œì™¸ íšŸìˆ˜ ì¦ê°€
      excludedPlayers.forEach(p => {
        playerExclusionCount[p] = (playerExclusionCount[p] || 0) + 1;
      });
      
      // ì°¸ì—¬ í”Œë ˆì´ì–´
      const excludedSet = new Set(excludedPlayers);
      const availablePlayers = shuffled.filter(p => !excludedSet.has(p));
      
      // íŒ€ ìƒì„±
      const teams = createTeamsFromPlayers(availablePlayers);
      
      // ê²Œì„ ìƒì„± (2íŒ€ì”© ë§¤ì¹­)
      const games = [];
      for (let i = 0; i < teams.length; i += 2) {
        if (i + 1 < teams.length) {
          games.push({
            team1: teams[i],
            team2: teams[i + 1]
          });
        }
      }
      
      return { games, excludedPlayers };
    }

    // ê¸°ë¡ ì €ì¥ (ë§¤ì¹­ ë¹ˆë„ ì—…ë°ì´íŠ¸)
    function saveRecord(games) {
      games.forEach(game => {
        const allPlayers = [...game.team1.players, ...game.team2.players];
        
        // ê°™ì€ ê²Œì„ì— ì°¸ì—¬í•œ ëª¨ë“  í”Œë ˆì´ì–´ ìŒì˜ ë§¤ì¹­ íšŸìˆ˜ ì¦ê°€
        for (let i = 0; i < allPlayers.length; i++) {
          for (let j = i + 1; j < allPlayers.length; j++) {
            incrementMatchCount(allPlayers[i], allPlayers[j]);
          }
        }
      });
    }

    // ì‹œë®¬ë ˆì´ì…˜ ì‹¤í–‰
    function runSimulation() {
      // ì´ˆê¸°í™”
      matchFrequency = {};
      playerExclusionCount = {};
      
      const playerCount = parseInt(document.getElementById('playerCount').value);
      const courtCount = parseInt(document.getElementById('courtCount').value);
      const rounds = parseInt(document.getElementById('rounds').value);
      
      let output = "";
      output += "=".repeat(60) + "\n";
      output += `ğŸ¸ ë°°ë“œë¯¼í„´ ë§¤ì¹­ ì‹œë®¬ë ˆì´ì…˜\n`;
      output += `ì°¸ê°€ì: ${playerCount}ëª… (1~${playerCount})\n`;
      output += `ì½”íŠ¸ ìˆ˜: ${courtCount}ê°œ\n`;
      output += `ì‹œë®¬ë ˆì´ì…˜ íšŸìˆ˜: ${rounds}íšŒ\n`;
      output += "=".repeat(60) + "\n\n";
      
      // í”Œë ˆì´ì–´ ìƒì„±
      const players = [];
      for (let i = 1; i <= playerCount; i++) {
        players.push(`${i}`);
      }
      
      // ë¼ìš´ë“œ ì‹¤í–‰
      for (let round = 1; round <= rounds; round++) {
        output += `\n<span class="round">ğŸ“ ë¼ìš´ë“œ ${round}</span>\n`;
        
        const { games, excludedPlayers } = generateGames(players, courtCount);
        
        output += `  íœ´ì‹: ${excludedPlayers.length > 0 ? excludedPlayers.join(", ") : "ì—†ìŒ"}\n`;
        
        games.forEach((game, idx) => {
          const team1 = game.team1.players.join(", ");
          const team2 = game.team2.players.join(", ");
          output += `  ì½”íŠ¸ ${idx + 1}: [${team1}] vs [${team2}]\n`;
        });
        
        // â­ ì¤‘ìš”: ê¸°ë¡ ì €ì¥ (ë§¤ì¹­ ë¹ˆë„ ì—…ë°ì´íŠ¸)
        saveRecord(games);
      }
      
      // ê²°ê³¼ ë¶„ì„
      output += "\n" + "=".repeat(60) + "\n";
      output += `<span class="stats">ğŸ“Š ë§¤ì¹­ ë¹ˆë„ ë¶„ì„</span>\n`;
      output += "=".repeat(60) + "\n";
      
      // ëª¨ë“  ë§¤ì¹­ ìŒì˜ ë¹ˆë„ ìˆ˜ì§‘
      const frequencies = [];
      for (let i = 1; i <= playerCount; i++) {
        for (let j = i + 1; j <= playerCount; j++) {
          const count = getMatchCount(`${i}`, `${j}`);
          frequencies.push({
            pair: `${i}-${j}`,
            count: count
          });
        }
      }
      
      // ë¹ˆë„ë³„ë¡œ ì •ë ¬
      frequencies.sort((a, b) => b.count - a.count);
      
      // í†µê³„
      const counts = frequencies.map(f => f.count);
      const max = Math.max(...counts);
      const min = Math.min(...counts);
      const avg = counts.reduce((a, b) => a + b, 0) / counts.length;
      const zero = counts.filter(c => c === 0).length;
      
      output += `\n<span class="highlight">ğŸ“ˆ í†µê³„:</span>\n`;
      output += `  ìµœëŒ€ ë§¤ì¹­ íšŸìˆ˜: ${max}íšŒ\n`;
      output += `  ìµœì†Œ ë§¤ì¹­ íšŸìˆ˜: ${min}íšŒ\n`;
      output += `  í‰ê·  ë§¤ì¹­ íšŸìˆ˜: ${avg.toFixed(2)}íšŒ\n`;
      output += `  í•œ ë²ˆë„ ë§¤ì¹­ ì•ˆ ëœ ìŒ: ${zero}ê°œ\n`;
      
      // ìƒìœ„ 10ê°œ (ê°€ì¥ ë§ì´ ë§¤ì¹­ëœ ìŒ)
      output += `\n<span class="highlight">ğŸ”¥ ê°€ì¥ ë§ì´ ë§¤ì¹­ëœ ìŒ (Top 10):</span>\n`;
      frequencies.slice(0, 10).forEach((f, idx) => {
        output += `  ${idx + 1}. ${f.pair}: ${f.count}íšŒ\n`;
      });
      
      // í•˜ìœ„ 10ê°œ (ê°€ì¥ ì ê²Œ ë§¤ì¹­ëœ ìŒ)
      output += `\n<span class="highlight">â„ï¸  ê°€ì¥ ì ê²Œ ë§¤ì¹­ëœ ìŒ (Bottom 10):</span>\n`;
      frequencies.slice(-10).reverse().forEach((f, idx) => {
        output += `  ${idx + 1}. ${f.pair}: ${f.count}íšŒ\n`;
      });
      
      // íœ´ì‹ íšŸìˆ˜
      output += `\n<span class="highlight">ğŸ˜´ íœ´ì‹ íšŸìˆ˜:</span>\n`;
      players.forEach(p => {
        const count = playerExclusionCount[p] || 0;
        output += `  ${p}: ${count}íšŒ\n`;
      });
      
      output += "\n" + "=".repeat(60) + "\n";
      
      document.getElementById('output').innerHTML = output;
    }

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì‹¤í–‰
    window.onload = () => {
      runSimulation();
    };
  </script>
</body>
</html>
